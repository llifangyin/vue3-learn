在 Vue 3 中，patchFlag 是编译阶段为每个虚拟节点（VNode）生成的一组标志，用于后续高效地执行 DOM 更新。下面介绍其核心内容和原理：

编译时生成
在模板编译时，Vue 会为每个节点分析哪些部分是动态变化的。比如，如果只有文本内容变化、或者只有某个 class 需要动态更新，那么编译器会为该节点打上相应的 patchFlag。这样在运行时，框架就能只对需要更新的部分进行处理。

常见的 patchFlag 类型
Vue 3 定义了一系列常量来表示不同的动态变化，例如：

TEXT：仅文本节点内容需要更新。
CLASS：仅 class 属性变化。
STYLE：仅 style 属性变化。
PROPS：存在其他属性变化。
FULL_PROPS：当动态属性较多时，会标记为全属性更新。
这些 flag 值往往是通过位运算组合的，这样可以在运行时快速判断当前节点需要检测哪些变化。
优化原理

跳过深度比对：通常情况下，在无任何 patchFlag 的情况下，Vue 会使用比对策略（深度 Diff）来检测节点中所有属性的变化。但当有 patchFlag 时，Vue 可以直接锁定变化部分，从而跳过不必要的比对。
减少开销：对于简单的静态节点或只发生局部变化的节点，利用 patchFlag 来做精确更新，极大减少了虚拟 DOM diff 的开销和组件更新的计算量。
实际使用场景
比如模板 <div class="static" :class="dynamicClass">{{ message }}</div>
编译器会分析 class 有动态依赖，同时文本节点也可能是动态的，就会给这个节点打上 CLASS | TEXT 的 patchFlag。在对比新旧 VNode 时，只有对应标记的属性才会进入更新逻辑，从而保证高效更新。

总的来说，patchFlag 为 Vue 的虚拟 DOM diff 算法提供了“一针见血”的更新指引，避免了不必要的检查和遍历，使得 Vue 3 在大多数组件更新场景下性能大幅提升。